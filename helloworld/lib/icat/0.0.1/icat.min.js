!function(a){var b,c="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;"undefined"!=typeof exports?(b=a(c,!0),"undefined"!=typeof module&&module.exports?exports=module.exports=b:exports.ICAT=b):(b=c.ICAT=a(c),"function"==typeof define&&(define.amd?define("icat",[],function(){return b}):define.cmd&&define(function(a,c,d){d.exports=b})))}(function(a,b,c){function d(a){var b=(f()||0,(new Date).getTime());z.util.getLifecycle(a||"pageLoad",b-_BaseTime_)}function e(){if(A.currentScript)return A.currentScript;var a=A.getElementsByTagName("script"),b=a.length;if(0!==b){if(1===b)return a[0];if("readyState"in a[0])for(var c=a.length;c--;)if("interactive"===a[c].readyState)return a[c];if("loading"===A.readyState)return a[b-1];var d;try{throw Error("get currentJS")}catch(e){e.fileName?d=e.fileName:e.stack?d=e.stack.split(/\s+/).pop().replace(/(^\w+@)|((\:\d+)+$)/g,""):e.sourceURL&&(d=e.sourceURL)}if(d)for(var f=0;b>f;f++)if(a[f].src===d)return a[f];return d||a[b-1]}}function f(){var b,d=!1;return b=a.performance||a.msPerformance||a.webkitPerformance||a.mozPerformance,b&&b.timing&&b.timing.navigationStart?d=b.timing.navigationStart:a.chrome&&a.chrome.csi&&a.chrome.csi().startE?d=a.chrome.csi().startE:a.gtbExternal&&a.gtbExternal.startE()&&(d=a.gtbExternal.startE()),navigator.userAgent.match(/Firefox\/[78]\./)&&(d=b.timing.unloadEventStart||b.timing.fetchStart||c),d}function g(){if(arguments.length)if(1==arguments.length){var a=A.cookie;if(a.length<=0)return;var b=arguments[0],c=a.indexOf(b+"=");if(-1!=c)return c=c+b.length+1,cEnd=a.indexOf(";",c),-1==cEnd&&(cEnd=a.length),unescape(a.substring(c,cEnd))}else{var b=arguments[0],d=arguments[1],e=arguments[2]||60,f=new Date,g="";f.setTime(f.getTime()+1e3*e),g="; expires="+f.toGMTString(),A.cookie=b+"="+escape(d)+g+"; path=/"}}function h(a,b,d,e){var f,g=0,h=a.length,i=e||h===c;if(d)if(i){for(f in a)if(b.apply(a[f],d)===!1)break}else for(;h>g&&b.apply(a[g++],d)!==!1;);else if(i){for(f in a)if(b.call(a[f],a[f],f)===!1)break}else for(;h>g&&b.call(a[g],a[g],g)!==!1;g++);}function i(a,b,c){if(!b||!a)return a;var d,e=!0;if(c&&z.isString(c)&&(c=c.replace(/\s+/g,"").split(","),e=!1),c&&(d=c.length)){var f={};e?h(c,function(a){b[a]&&(f[a]=b[a])}):h(b,function(a,b){m(c,b)||(f[b]=a)}),j(a,f)}else j(a,b);return a}function j(a){var b=Array.prototype.slice.call(arguments,1);return h(b,function(b){if(b)for(var c in b)z.isObject(a[c])&&z.isObject(b[c])?a[c]=j(a[c],b[c]):z.isArray(a[c])?a[c]=l(a[c].concat(b[c])):a[c]=b[c]}),a}function k(a){if(a){var b;b=a.constructor==Object?new a.constructor:new a.constructor(a.valueOf());for(var c in a)b[c]!=a[c]&&(z.isObject(a[c])?b[c]=k(a[c]):z.isArray(a[c])?b[c]=a[c].concat():b[c]=a[c]);return b}}function l(b){var c={},d=[];return h(b,function(b){var e=a.JSON&&z.isObject(b)?a.JSON.stringify(b):b;c[e]||(d.push(b),c[e]=!0)}),d}function m(a,b){return z.isArray(a)?n(a,b)>-1:z.isObject(a)?b in a:z.isString(a)?a.indexOf(b)>-1:!1}function n(a,b){if("indexOf"in a)return a.indexOf(b);var c=-1;return h(a,function(a,d){return a===b?(c=d,!1):void 0}),c}function o(a){var b,c=z.util.zenCoding;return c.frags={},c.fragIndex=0,b=v(a,c),b=w(b,c),z.foreach(c.frags,function(a,b){/\{\d+\}/.test(b)&&(c.frags[b.replace(/\{|\}/g,"")]=x(a))}),p(b).join("").replace(/(\&nbsp;)|(\{\s+\})/g,"")}function p(a){var b=a.split("+"),c=[];return z.foreach(b,function(a,b){if(/\{\d+\}/.test(a))if(~a.indexOf("*")){a=a.split("*");for(var d=y(a[0]),e="",f=0;f<a[1];f++)e+=d;c[b]=e}else c[b]=y(a);else c[b]=x(a)}),c}function q(a){if(!a)return"";var b,d,e=[],f={},g=[];return b=a.match(/(\#[\w\-\d]+)|(\.[\w\-\d]+)|(\[[^\]]+\])/g),b&&z.foreach(b,function(a){"["===a.charAt(0)?g.push(a.replace(/\[|\]/g,"")):"."===a.charAt(0)&&f[a]===c?(e.push(a.slice(1)),f[a]=!0):d=d||a.slice(1)}),d&&g.push('id="'+d+'"'),e.length&&g.push('class="'+e.join(" ")+'"'),g.join(" ")}function r(a,b){if(!a)return"";if(/\<[^\>]+\>/.test(a))return a;if(/[\+\*\>\{]/.test(a))return x(a);var c,d=a.match(/^[^\W]+/),e=q(a);return e=e?" "+e:"",b=b||"&nbsp;",d||(d="div"),c="<"+d+e+(/img|input|br|hr/i.test(d)?" />":">"+b+"</"+d+">")}function s(a){if(!a)return"";var b=a.split("+"),c="";return z.foreach(b,function(a){c+=r(a)}),c}function t(a){if(!a)return"";for(var b=a.split("*"),c="",d=0;d<(b[1]||0);d++)c+=r(b[0]);return c}function u(a){if(!a)return"";var b=a.split(">"),c="&nbsp;";return z.foreach(b,function(a){c=c.replace(/\&nbsp;/g,r(a))}),c}function v(a,b){if(!a)return"";if(!/\([^\(\)]+\)/.test(a))return a;var d=a.match(/\([^\(\)]+\)/g);return z.foreach(d,function(d){var e="{"+b.fragIndex+"}";b.frags[d]===c&&(b.frags[e]=d.replace(/\(|\)/g,"")),a=a.split(d).join(e),b.fragIndex++}),/\([^\(\)]+\)/.test(a)?v(a,b):a}function w(a,b){if(!a)return"";if(a.indexOf(">")<0)return a;var d=/[^\>\+]+\>[^\>]+$/,e=a.match(d);if(e){var f="{"+b.fragIndex+"}",g=e[0];b.frags[g]===c&&(b.frags[f]=g),a=a.replace(d,f),b.fragIndex++}return~a.indexOf(">")?w(a,b):a}function x(a){return~a.indexOf(">")?u(a):~a.indexOf("+")?s(a):~a.indexOf("*")?t(a):a.indexOf("{")<0?r(a):a}function y(a){var b=a.split(/\{|\}/g),c=z.util.zenCoding,d=[];return z.foreach(b,function(a,b){if(a)if(isNaN(a))d[b]=a;else{var e=c.frags[a];d[b]=e?y(e):"{"+a+"}"}else d[b]=""}),d.join("")}var z=a.ICAT||{version:"0.0.1"};if(h(["String","Boolean","Function","Array","Object","Number","RegExp","IE"],function(a){z["is"+a]="IE"==a?!-[1]:function(b){return b===c||null===b?!1:Object.prototype.toString.call(b).slice(8,-1)===a}}),j(z,{foreach:h,deepClone:k,mixin:j,mix:i,extend:function(){var a,c=this,d=Array.prototype.slice.call(arguments);return b||(h(d,function(b,c){b.events&&(a=a||{},j(a,b.events),delete b.events)}),a&&z.util.bindEvent(a,null,c)),d.unshift(c),j.apply(c,d),c},util:function(a,b){z.isString(a)?z.util[a]=b||function(){}:z.isFunction(a)?i(z.util,a()):z.isObject(a)?i(z.util,a):z.isArray(a)&&h(a,function(a){a.utilName&&a.callback&&(z.util[a.utilName]=a.callback)})},widget:function(a,b){z.isString(a)?z.widget[a]=z.isFunction(b)?b():b:z.isObject(a)?h(a,function(a,b){a&&(z.widget[b]=z.isFunction(a)?a():a)}):z.isArray(a)&&h(a,function(a){var b=a.create;a.widgetName&&b&&(z.util[a.widgetName]=z.isFunction(b)?b():b)})},react:function(b,c,d,e,f){z.react[b]=function(b){var g=a.ReactForiCat||a.React;g&&(b.argus&&(e=e||{},z.mixin(e,b.argus),delete b.argus),z.mix(d.defaultProps,b,"el"),c.render(g.createElement(d,e),b.el||f))}},wait:function(a,b,c){b=b||100,c=c||10;var d=z.wait,e=0,f="icat_timer"+Math.floor(1e6*Math.random()+1);a(!1)===!1&&(d[f]=setInterval(function(){a(e>=b)===!1&&b>e?e+=c:(clearInterval(d[f]),delete d[f])},c))},encrypt:function(a,b){for(var c=[],d=a.length,e=b.length,f=0;d>f;f++){var g=a.charCodeAt(f)^b.charCodeAt(f%e);c.push(g)}return c.join("^")},decode:function(a,b){if(!z.isString(a)||!/^\d+(\^\d+)+$/.test(a))return"";for(var c=a.split("^"),d=c.length,e=b.length,f=[],g=0;d>g;g++){var h=+c[g]^b.charCodeAt(g%e);f.push(String.fromCharCode(h))}return f.join("")},trim:function(a,b){return b?a.replace(/\s/g,""):a.replace(/^\s+|\s+$/g,"")},removeExcess:function(a){return a=a.replace("??","@"),a.replace(/(\?|#).*$/,"").replace("@","??")}}),z.util({zenCoding:o,getLayouts:function(a){var b=a.framework,c=[],d=a.gridclass.charAt(1),e=[],f=[],g=[];return c.push(".grid."+a.gridclass+">"),"-"==d?(_.each(a.$main,function(a){e.push('[data-wgtype="'+a+'"]')}),c.push(e.join("+"))):(c.push("(.col-main>.main-wrap"),_.each(a.$main,function(a){e.push('[data-wgtype="'+a+'"]')}),c.push(e.length?">"+e.join("+"):""),c.push(") + "+(3==d?"(":"")+".col-sub"),_.each(a.$sub,function(a){f.push('[data-wgtype="'+a+'"]')}),c.push(f.length?">"+f.join("+"):""),3==d&&(c.push(") + .col-extra"),_.each(a.$extra,function(a){g.push('[data-wgtype="'+a+'"]')}),c.push(g.length?">"+g.join("+"):""))),o(b.replace("{grid}",c.join("")))}}),b);else{var A=a.document;z.$=a.jQuery||a.Zepto||a.ender||a.$,z.XMD=a.seajs||a.require,z.shim={},z.icatjs||(z.icatjs=e()||{}),a._BaseTime_||(a._BaseTime_=f()||(new Date).getTime()),h({DebugMode:/[\?&#]debug/i,DemoMode:/file\:\/{3}|localhost/i,IPMode:/\/\d+(\.\d+){3}(\:\d+)?\//},function(a,b){z[b]=a.test(location.href)}),z.extend({APPGROUP:{},TPLCACHE:{},CONFIG:{alias:{},vars:{},combo:!1,extensions:[".js",".json",".css"],map:"~.min",DebugMode:z.DebugMode||z.DemoMode||z.IPMode},hasItem:m,unique:l,removeItem:function(a,b){if(!z.hasItem(a,b)&&z.isNumber(b))a.splice(b,1);else{var c=n(a,b);-1!==c&&a.splice(c,1)}return a},isjQueryObject:function(a){return z.$?a instanceof z.$:!1},isEmptyObject:function(a){for(var b in a)return!1;return!0},app:function(b,c){var d=z.isString(b),e=d?a[b]||{}:b;return d&&(z.APPGROUP[b]=a[b]=e),i(e,z,["extend","namespace","router"]),j(e,z.isFunction(c)?c():c),e},namespace:function(){var b,c,d,e=arguments,f=e.length,g=null;for(b=0;f>b;++b)for(d=(""+e[b]).split("."),g=this,c=a[d[0]]===g?1:0;c<d.length;++c)g=g[d[c]]=g[d[c]]||{};return g},ready:function(a){var b,c=[],d=A.documentElement,e=d.doScroll,f=(e?/^loaded|^c/:/^loaded|c/).test(A.readyState),g=function(a){for(f=1;a=c.shift();)a()};return A.addEventListener&&A.addEventListener("DOMContentLoaded",b=function(){A.removeEventListener("DOMContentLoaded",b,!1),g()},!1),e&&A.attachEvent("onreadystatechange",b=function(){/^c/.test(A.readyState)&&(A.detachEvent("onreadystatechange",b),g())}),a=e?function(b){self!=top?f?b():c.push(b):function(){try{e("left")}catch(c){return setTimeout(function(){a(b)},50)}b()}()}:function(a){f?a():c.push(a)}}(),log:function(b){if(z.CONFIG.DebugMode){var c=(console||{}).log,d=Array.prototype.slice.call(arguments);if(z.isIE)a.console&&console.log?c.apply(console,d):alert(b);else try{__$abc_ICAT()}catch(e){var f=e.stack.match(/\([^\)]+\)/g);f=f?f[2]:"",f=f||"",z.isString(d[0])&&~d[0].indexOf("@file")?(f=f.replace(/[^\/]+\//g,"").replace(/[\(\)\/\"\']/g,""),d[0]=d[0].replace("@file","%c"+f),d.push("color:#ddd;text-decoration:underline;")):(f=f.replace(/^\(|\)$/g,""),d.unshift(f+"\n")),c.apply(console,d)}}}}),z.util({insertRule:function(a,b,c,d){if(!c){var e=A.getElementById("blankSheet");if(e||(e=A.createElement("style"),e.id="blankSheet",(A.head||A.documentElement).appendChild(e)),e.sheet)c=e.sheet;else{var f=A.styleSheets,g=f.length-1;c=f[g]}}d=d||(c.cssRules||c.rules).length,"insertRule"in c?c.insertRule(a+"{"+b+"}",d):"addRule"in c&&c.addRule(a,b,d)},insertCss:function(a){var b=A.getElementById("blankSheet"),c="";if(b){var c=b.innerHTML;b.parentNode.removeChild(b)}var d=A.createElement("p"),e=A.head||A.documentElement;return d.innerHTML='x<style id="blankSheet">'+(c+a)+"</style>",e.appendChild(d.lastChild)},getTemplate:function(a,b,d){if(a){var e,f,g,i=z.isString(d)?d:"";if(/\<[^\>]+\>/.test(a))f=a.replace(/\r\t\n/g,""),a=c;else{if(z.templates=z.templates||{},g=A.getElementById(a.replace(".tpl","")),a=~a.indexOf(".tpl")?a:a+".tpl",e=z.TPLCACHE[a])return b?e(b):e;d&&z.isObject(d)?f=d.templates?d.templates[a]:d[a]:z.templates[a]?f=z.templates[a]:g?f=(g.innerHTML||"").replace(/[\r\t\n]/g,""):z.foreach(z.APPGROUP,function(b){return b.templates&&b.templates[a]?(f=b.templates[a],!1):void 0})}if(f){var j=f.match(/<define[^>]*>(.(?!define))*<\/define>/g),k={};j?(h(j,function(a){f=f.replace(a,"");var b=a.match(/<define\s+name\=\"(\w+)\">/),c=a.replace(/<\/?define[^>]*>/g,""),d=b[1];d&&(k[d]=_.template(c,{variable:"o"}),z.TPLCACHE[(i?i+"_":"")+d]=k[d])}),e=function(a){a=a||{},a.micro={};for(var b in k)!function(b){a.micro[b]=function(){return k[b](a)}}(b);return _.template(f,{variable:"o"})(a)}):e=_.template(f,{variable:"o"}),a&&(z.TPLCACHE[a]=e)}else f='<div class="no-tpl"><span class="text-muted">'+a+"模板有误，请检查</span></div>",e=_.template(f,{variable:"o"}),a=c;return b?e(b):e}},getMicroTemplate:function(a,b){var c=z.TPLCACHE[a]||function(){};return b?c(b):c},storage:function(){var a,b,c=arguments,d=!window.localStorage,e=c.length;return 1==e?(a=c[0],d?g(a):localStorage.getItem(a)):(a=c[0],b=z.isObject(c[1])||z.isArray(c[1])?JSON.stringify(c[1]):c[1],d?g(a,b):(localStorage.removeItem(a),localStorage.setItem(a,b)),void 0)},bindEvent:function(b,c,d){if(b&&z.isObject(b)){if(!z.$){var e=a.jQuery||a.Zepto||a.ender||a.$;e&&(z.$=e)}z.$&&z.foreach(b,function(a,b){var e=b.replace(/^(\S+)\s+/,"$1@").split("@"),f=e[0]+".icatEventDelegate",g=e[1];z.$(c||A).on(f,g,function(b){var c=z.util.getCallback(a,d);c&&c.callback.apply(c.context,[b,z.ROUTERPARAM])})})}},unbindEvent:function(b,c){if(b){if(!z.$){var d=a.jQuery||a.Zepto||a.ender||a.$;d&&(z.$=d)}z.$&&(b=z.isArray(b)?b.join(","):b,b=z.trim(b,!0).split(","),z.foreach(b,function(a){a+=".icatEventDelegate",z.$(c||A).off(a)}))}},getCallbacks:function(a){var b,c=this;return z.isArray(a)?(b=[],h(a,function(a){var d=c.getCallback(a.fname,a.from);a.fid&&(d.originalRule=a.originalRule,d.fid=a.fid),b.push(d)})):b=c.getCallback(a.fname,a.from),b},getCallback:function(b,c){if(!b)return{callback:function(){},context:c||a};if(z.isFunction(b))return{callback:b,context:c||a};if(z.isString(b)){var d,e;if(b=z.trim(b),~b.indexOf(".")){var f=b.split("."),g=f.length-1;h(f,function(b,c){return d=0==c?a[b]:d[b],c==g-1&&(e=d),d?void 0:!1})}else{if(c)return{callback:c[b],context:c};var i=!1;if(h(z.APPGROUP,function(a){a[b]&&(d=a[b],e=a,i=!0)}),!i&&a[b])return{callback:a[b],context:a}}return{callback:d,context:e}}return z.isObject(b)?b:void 0},getCurrentJS:e,getCurPath:function(){var a=e();return(a?a.src:"").replace(/\/[^\/]+$/,"")},template:function(a,b){var c,d,e=function(){return""};return a?(a=a.replace(/[\r\t\n]/g,""),c="var __p_fun = [], _self = jsonData; with(jsonData){__p_fun.push('"+a.replace(/\<%\=(.*?)%\>/g,"',(typeof $1!='undefined'? $1:''),'").replace(/\<%(.*?)%\>/g,"');$1__p_fun.push('")+"');};return __p_fun.join('');",d=new Function("jsonData",c),b?d(b):d):e},getLifecycle:function(a,b){if(z.TIMING===c&&(z.TIMING={baseUrl:location.href}),z.TIMING[a]=b+(~a.indexOf("-")?0:"ms"),/\-\w+End$/.test(a)){var d=a.replace("End","");z.TIMING[d]=b-(z.TIMING[d+"Begin"]||0)+"ms"}}}),z.$&&j(z.$.fn,{getCurrentView:function(){var a;return this.each(function(b,c){return c.viewId?(a=c.viewId,!1):void 0}),z.util.getView[a]||null},delCurrentView:function(){this.each(function(a,b){b.viewId&&delete b.viewId})}}),z.ready(function(){d("pageReady")}),a.addEventListener?a.addEventListener("load",function(){d(),console.log({timing:z.TIMING})},!1):a.attachEvent&&a.attachEvent("onload",function(){d(),console.log({timing:z.TIMING})})}return z}),function(a,b,c,d){function e(){a.foreach(a.RULEFUNS,function(b,c){if(!~c.indexOf("※")){var e,f=location.pathname.replace(/^\/\w\:/,""),g=location.hash.slice(1),h=a.CONFIG.vars;b=a.util.getCallbacks(b);var i=a.RULELIST[c],j=b[0],k=j?j.callback:d;if(i.HashMode)i.rule.test(g)&&(e=m(i,f,g),k&&k.apply(j.context,[e]));else if(i.hashRule)i.rule.test(f)&&i.hashRule.test(g)&&(e=m(i,f,g),k&&k.apply(j.context,[e]));else if(i.rule.test(f))if("*"==i.originalRule){if(e=a.ROUTERPARAM,b.length>1){var l=b.concat();a.foreach(l.slice(1),function(a){var c=b[a.fid-1];c.exec=function(){c.callback.apply(c.context,[e,function(){a.exec.apply(a.context)}])},a.exec=function(){a.callback.apply(a.context,[e,function(){}])}})}j=b[0],k=j?j.exec||j.callback:d,k&&k.apply(j.context,[e])}else e=m(i,f,g),e.vars=h,k&&k.apply(j.context,[e])}})}function f(b,c,e){if(b!==d)if(a.isString(b)||a.isArray(b))i(b,c,e);else if(a.isObject(b))a.isObject(c)&&(e=c),a.foreach(b,function(a,b){i(b,a,e)});else if(a.isRegExp(b)){var f=b.toString().replace(/^\/(\^)?|(\$)?\/$/g,""),g={rule:b,keys:[],stringRule:f};i(g,c,e)}}function g(b){var c=j(b);a.foreach(c,function(b){var c=a.RULEFUNS[b.stringRule],d=[];c&&c.length&&(a.foreach(c,function(a,c){a.originalRule==b.originalRule||d.push(a)}),a.RULEFUNS[b.stringRule]=d)})}function h(b,c,d){var e=j(b);a.foreach(e,function(b){if("*"!=b.originalRule){var e=a.RULEFUNS[b.stringRule];e&&e.length&&a.foreach(e,function(a,e){a.originalRule==b.originalRule&&(a.fname=c,a.from=d)})}})}function i(b,c,d){var e=a.RULECODE,f=a.RULEFUNS,g=a.RULELIST,h=j(b);a.foreach(h,function(b){if(g[b.stringRule]){var h={fname:c,from:d},i=f[b.stringRule];h.fid=i.length,h.originalRule=b.originalRule,f[b.stringRule].push(h);var j=g[b.stringRule],k=j.keys,l=j.hashKeys,m=[],n=[];a.foreach(k,function(a,c){var d=b.keys[c];d&&d!==a?m.push((a+"|"+d).replace(/\:/g,"")):m.push(a)}),l&&a.foreach(l,function(a,c){var d=b.hashKeys[c];d&&d!==a?m.push((a+"|"+d).replace(/\:/g,"")):m.push(a)}),j.keys=m,j.hashKeys=n}else{var o=e._index_,h={fname:c,from:d};f[b.stringRule]||(f[b.stringRule]=[]),e[b.stringRule]=o,e[o]=b.stringRule,e._index_=o+1,h.fid=0,h.originalRule=b.originalRule,f[b.stringRule].push(h),g[b.stringRule]=b}})}function j(b){if(a.isObject(b))return[b];var c=[],d={};return b=a.isArray(b)?b.join(","):a.isString(b)?b:"",b=a.trim(b,!0),a.foreach(b.split(","),function(a){/^all$/i.test(a)&&(a="*"),d[a]||(c.push(k(a)),d[a]=!0)}),c}function k(a){var c,d,f,g=a.charAt(0),h={originalRule:a};return"#"===g?(f=a.slice(1),c=l(f),"onhashchange"in b&&(b.onhashchange=function(){e()}),h.rule=new RegExp("^"+c[0]+"$"),h.stringRule=c[0],h.HashMode=!0,h.keys=c[1]||[]):(~a.indexOf("#")?(a=a.split("#"),c=l(a[0]),d=l(a[1]),h.hashRule=new RegExp("^"+d[0]+"$"),h.hashKeys=d[1]||[]):c=l(a),h.stringRule=c[0]+(d?d[0]:""),h.rule=new RegExp("^"+c[0]+"$"),h.keys=c[1]||[]),h}function l(a){if(""==a)return["\\/"];if("*"==a)return[".*"];var b=a.match(/\:\w+/g),c=a.replace(/\*{2}/g,"[/\\w-]+").replace(/\*/g,"[^/]+").replace(/\?/g,"[^/]").replace(/([\.\-\/])/g,"\\$1").replace(/\:\w*(num|id|index)/gi,"(\\d+)").replace(/\:\w+/g,"([\\w\\-]+)");return b?[c,b]:[c]}function m(b,c,d){var e=b.rule,f=location.search.slice(1),g=function(b,e,f){var g=f?d.match(b):c.match(b);if(g=g||[],g.shift(),e){var h=a.ROUTERPARAM[f?"hashs":"paths"];a.foreach(e,function(b,c){~b.indexOf("|")?(b=b.split("|"),a.foreach(b,function(a){h[a]=g[c]})):h[b.slice(1)]=g[c]})}else h=g};return f&&a.foreach(f.split("&"),function(b){b=b.replace(/^([\w\-]+)\=/,"$1{@}").split("{@}"),a.ROUTERPARAM.searchs[b[0]]=b[1]}),b.HashMode?g(e,b.keys,!0):b.hashRule?(g(e,b.keys),g(b.hashRule,b.hashKeys,!0)):g(e,b.keys),a.ROUTERPARAM}a.RULECODE=a.RULECODE||{_index_:0},a.RULEFUNS=a.RULEFUNS||{},a.RULELIST=a.RULELIST||{},a.ROUTERPARAM=a.ROUTERPARAM||{paths:{},searchs:{},hashs:{}},a.router=function(b,c){var d=this,h=arguments.length,i=d.routes;switch(!d._bindDefaultRoutes_&&i&&(f(i,d),d._bindDefaultRoutes_=!0),h){case 0:e();break;case 1:a.isObject(b)?f(b,d):a.isFunction(b)?f("*",b):g(b);break;default:a.isObject(b)?f(b,d):f(b,c,d)}return d},a.router.update=h,a.router.remove=g,~(c.baseURI||location.href).indexOf("router_test")&&(a.router_test={},a.mix(a.router_test,{trigger:e,optInsert:f,optDelete:g,optUpdate:h,getRule:j,getOneRule:k}))}(ICAT,this,document),function(a,b,c,d){function e(b,c,d){var e,f,g=[];if(e=p(b.files,b.callback),a.foreach(e.ids,function(b){var c,d=a.CONFIG,e=a.RULELIST,f=a.RULECODE,h=d.timestamp?"?"+d.timestamp:"";if(b=""+b,~b.indexOf("+")){var i=[],j=!1;a.foreach(b.split("+"),function(a){var b=f[a],c=e[b];i.push(c.rule),j="css"===c.ext}),c=d.domain+"??"+i.join(","),g.push({id:b,isCSS:j,file:c,logKey:i.join(","),url:c+h})}else{var k=f[b],l=e[k];c=(l.weburl?"":d.domain)+l.rule,g.push({id:b,isCSS:"css"===l.ext,logKey:l.rule,file:c,url:c+(l.weburl?"":h)})}}),e.hasIds.length&&!e.ids.length)return void a.wait(function(a){return a?console.warn("某个文件未加载成功，请检查"):l(e.hasIds)?void j(e.hasIds,!0):!1},5e3);if(e.hasIds.length||"use"!==d||(d="require"),e.hasIds.length&&"require"===d&&(d="use"),"use"===d)a.wait(function(a){if(a)return console.warn("依赖的文件未加载成功，请检查");if(!l(e.hasIds))return!1;var b=function(){if(g.length){var a=g.shift();c(a,g.length?b:null)}};if(g.length){var d=g.shift();c(d,b)}},5e3);else if("require"===d){if(f=function(){if(g.length){var a=g.shift();c(a,g.length?f:null)}},g.length){var h=g.shift();c(h,f)}}else a.foreach(g,function(a){c(a)})}function f(b){if(b&&a.isObject(b)){var d=b.isCSS?"link":"script",e=b.isCSS?' type="text/css" rel="stylesheet"':' type="text/javascript"',f=(b.isCSS?"href":"src")+'="'+b.url+'"';c.write("<"+d+e+f+(b.isCSS?"/>":"></"+d+">"));var g=a.RULECODE,h=a.RULELIST;if(~b.id.indexOf("+")){var i=b.id.split("+");a.foreach(i,function(a){var b=g[a],c=h[b];c.ready=!0}),j(i)}else{var k=g[b.id],l=h[k];l.ready=!0,j(b.id)}}}function g(b,c){b&&a.isObject(b)&&(a.util.getLifecycle(b.logKey+"-loadBegin",(new Date).getTime()-_BaseTime_),b.isCSS?h(b,c):i(b,c))}function h(b,d){var e=c.createElement("link"),f=c.head||c.getElementsByTagName("head")[0],g=a.RULELIST,h=a.RULECODE;if(e.setAttribute("type","text/css"),e.setAttribute("rel","stylesheet"),e.setAttribute("href",b.url),a.util.getLifecycle(b.logKey+"-loadEnd",(new Date).getTime()-_BaseTime_),f.appendChild(e),d&&d(),~b.id.indexOf("+")){var i=b.id.split("+");a.foreach(i,function(a){var b=h[a],c=g[b];c.ready=!0}),j(i)}else{var k=h[b.id],l=g[k];l.ready=!0,j(b.id)}}function i(b,d){var e=c.createElement("script"),f=c.head||c.getElementsByTagName("head")[0],g=a.RULELIST,h=a.RULECODE;e.setAttribute("type","text/javascript"),e.setAttribute("src",b.url),e.setAttribute("async",!0),k(a.CONFIG.ignoreXMD||"backbone.js, mvclib.js",b.url),"onload"in e?e.addEventListener("load",fnReady=function(){if(a.util.getLifecycle(b.logKey+"-loadEnd",(new Date).getTime()-_BaseTime_),e.removeEventListener("load",fnReady,!1),d&&d(),~b.id.indexOf("+")){var c=b.id.split("+");a.foreach(c,function(a){var b=h[a],c=g[b];c.ready=!0}),j(c)}else{var f=h[b.id],i=g[f];i.ready=!0,j(b.id)}},!1):e.readyState&&e.attachEvent("onreadystatechange",fnReady=function(){if(/loaded|complete/i.test(e.readyState))if(a.util.getLifecycle(b.logKey+"-loadEnd",(new Date).getTime()-_BaseTime_),e.detachEvent("onreadystatechange",fnReady),d&&d(),~b.id.indexOf("+")){var c=b.id.split("+");a.foreach(c,function(a){var b=h[a],c=g[b];c.ready=!0}),j(c)}else{var f=h[b.id],i=g[f];i.ready=!0,j(b.id)}}),f.appendChild(e)}function j(c,e){if(!a.$){var f=b.jQuery||b.Zepto||b.ender||b.$;a.$=f,a.$&&a.mixin(a.$.fn,{getCurrentView:function(){var b;return this.each(function(a,c){return c.viewId?(b=c.viewId,!1):void 0}),a.util.getView[b]||null},delCurrentView:function(){this.each(function(a,b){b.viewId&&delete b.viewId})}})}if(!a.XMD){var g=b.seajs||b.require;g&&(a.XMD=g),b.define&&define.amd&&setRequire()}b.Backbone&&b.Backbone._viewRender_===d&&(a.util.viewRender(),b.Backbone._viewRender_=!0),a.isArray(c)?e?a.foreach(a.RULEFUNS,function(b,d){if(~d.indexOf("※")&&/\|$/.test(d)){d=d.replace(/^※|\|$/g,"");var e,f,g=d.split("+");if(g.length!==c.length)return;if(g.sort(),c.sort(),g.join("+")!==c.join("+"))return;f=b.shift(),f&&(e=a.util.getCallbacks(f),e&&e.callback.apply(e.context))}}):j(c[0]):a.foreach(a.RULEFUNS,function(b,d){if(~d.indexOf("※")){d=d.slice(1);var e,f,g=d.split(/[\+\|\~]/);if(a.removeItem(g,""),!a.hasItem(g,c))return;1==g.length?(f=b.shift(),f&&(e=a.util.getCallbacks(f),e&&e.callback.apply(e.context))):l(g)&&(f=b.shift(),f&&(e=a.util.getCallbacks(f),e&&e.callback.apply(e.context)))}})}function k(c,e){if(b.define&&c){define._amd===d&&(define._amd=define.amd),c=a.trim(c,!0);var f,g=c.split(","),h=[];a.foreach(g,function(a){h.push(a.replace(".","\\.([^\\.]+\\.)?"))}),f=new RegExp("("+h.join("|")+")","i"),f.test(e)?define.amd=!1:define.amd=define._amd}}function l(b){var c=b.concat(),d=a.RULECODE,e=a.RULELIST;return a.foreach(b,function(b){var f=d[b],g=e[f];return g.ready&&a.removeItem(c,b),!!g.ready}),!c.length}function m(b){var e=function(b){if(b=a.trim(b,!0)){if(~b.indexOf("??")){var c=b.split("??"),d=[],e=c[0]||"",f=(c[1]||"").replace(/\?[^\?]+$/g,"");return"//"===e.slice(0,2)&&(e="http:"+e),a.foreach(f.split(","),function(a){d.push(e+a)}),d.join(",")}return b}};b?p(b):(a.foreach(c.getElementsByTagName("script"),function(a){var b=e(a.src||"");b&&p(b,d,null,!0)}),a.foreach(c.getElementsByTagName("link"),function(a){var b=e(a.href||"");b&&p(b,d,null,!0)}))}function n(a){}function o(a){}function p(b,c,d,e){var f,g=a.RULECODE,h=a.RULEFUNS,i=a.RULELIST,j=r(b),k=a.CONFIG,l=[],m=[],n=[],o=[],p=[],s={fname:c,from:d},t=[];return a.foreach(j,function(a){if(i[a.stringRule]){var b=g[a.stringRule];p.push(b)}else{var b=g._index_;if(g[a.stringRule]=b,g[b]=a.stringRule,g._index_=b+1,i[a.stringRule]=a,e)return a.ready=!0;"css"===a.ext?(l.push(a),(!k.combo||k.DebugMode)&&m.push(b)):(n.push(a),(!k.combo||k.DebugMode)&&o.push(b))}}),e?void 0:(k.combo&&!k.DebugMode&&(o=q(n),m=q(l)),f="※"+(p.length?p.join("+")+"|":"")+(m.length?m.join("~")+"~":"")+o.join("~"),h[f]?h[f].push(s):h[f]=[s],t=t.concat(m,o),{hasIds:p,ids:t})}function q(b){var c="",d=[],e=a.RULECODE;return a.foreach(b,function(a){var b=e[a.stringRule];c+=a.weburl?"@"+b+"@":b+"+"}),a.foreach(c.split("@"),function(a){a&&d.push(a.replace(/^\+|\+$/g,""))}),d}function r(b){var c=[];return b=a.isArray(b)?b.join(","):a.isString(b)?b:"",b=a.trim(b,!0),a.foreach(b.split(","),function(b){if(b)if(b=w(b),~b.indexOf(">")||/^\-?[\w\.]+(@(\d+\.){2}\d+)?$/.test(b)){var d,e="-"===b.charAt(0);b=e?b.slice(1):b,d=t(b,e),a.foreach(d,function(a){c.push(s(a))})}else c.push(s(b))}),c}function s(b){var c,d,e,f,g,h,i=v(b),j={originalRule:b},k=u(i.fileName),l=a.CONFIG,m=l.path,n=i.domain;if(i.delv&&(m=m.replace(/\/[\d\.]+\//g,"/")),f=m.slice(0,m.length-1).split("/"),g=f.length,isNaN(n)){if(i.weburl){if(i.keep)c=k.fileRealName+(i.search||"")+(i.hash||""),d=k.fileRealName+(i.search?"?"+i.search:"")+(i.hash?"#"+i.hash:"");else{c=k.fileNameProduction;var o=i.search||l.timestamp,p=(i.hash||l.hash,l.DebugMode?k.fileNameDevelopment:c);d=p+(o?"?"+o:"")}h=i.path,n=i.domain||l.domain,e=n+h+d}}else{if(n>=g)h=i.path;else if(0==n)h=m+i.path;else{for(var q=0;n>q;q++)f.pop();h=f.join("/")+"/"+i.path}i.keep?(c=k.fileRealName+(i.search||"")+(i.hash||""),d=k.fileRealName+(i.search?"?"+i.search:"")+(i.hash?"#"+i.hash:""),n=l.domain,e=l.domain+h+d,i.weburl=!0):i.weburl?(n=l.domain,c=k.fileNameProduction,d=l.DebugMode?k.fileNameDevelopment:c,e=l.domain+h+d):(c=k.fileNameProduction,d=l.DebugMode?k.fileNameDevelopment:c,e=h+d)}return j.stringRule=(n+h+c).replace(/[^\w]/g,""),j.rule=e,j.ext=k.fileExtension,j.weburl=!!i.weburl,j}function t(b,c){b=a.trim(b,!0);var d=a.CONFIG,e=d.alias,f="("+d.extensions.join("|").replace(/\./g,"\\.")+")$",g=(new RegExp(f),b.split("@")),h=g[1];b=g[0];var i,j,k=e[b],l=b;return a.isString(k)&&(k=w(k),/@(\d+\.){2}\d+$/.test(k))?t(k,c):(~b.indexOf(">")&&(i=b.split(">"),l=i[i.length-1],k=function(a){for(;i.length;){var b=i.shift();if(!a[b]){a=null;break}a=a[b]}return a}(e)),k?(j=[],~b.indexOf(">")&&(k=d.DebugMode?k:l),k=(a.isArray(k)?k.join(","):k).split(","),a.foreach(k,function(b){b=a.trim(b,!0),b=b.replace(/@version\:((\d+\.){2}\d+)/gi,"@$1"),b=h?b.replace(/@(version|\:?(\d+\.){2}\d+)/gi,h):b.replace(/@(version\/?)?/gi,""),j.push(b)})):j=~b.indexOf(">")?[]:[b],c&&a.foreach(j,function(b){/\.css/.test(b)&&a.removeItem(j,b)}),j)}function u(b){if(b){b=b.toLowerCase();var c,d,e,f,g=a.CONFIG,h=new RegExp("("+g.extensions.join("|").replace(/\./g,"\\.")+")$"),i={};return i.fileRealName=b,h.test(b)?(f=b.match(h),f&&(i.fileExtension=f[1].slice(1))):(b+=".js",i.fileExtension="js"),"json"===i.fileExtension?(i.fileNameDevelopment=i.fileNameProduction=b,i):(g.map&&(c=g.map.split("~"),d=c[0],e=c[1],""==d?(i.fileNameDevelopment=~b.indexOf(e)?b.replace(e,""):b,i.fileNameProduction=~b.indexOf(e)?b:b.replace(/(\.\w+)$/,e+"$1")):(i.fileNameDevelopment=~b.indexOf(d)?b:e&&~b.indexOf(e)?b.replace(e,d):b.replace(/(\.\w+)$/,d+"$1"),i.fileNameProduction=~b.indexOf(d)?b.replace(d,e):e&&~b.indexOf(e)?b:b.replace(/(\.\w+)$/,e+"$1"))),i)}}function v(b,d){if(b){var e,f,g=a.CONFIG.domain,h=g?g.replace(/^\w+\:/,""):"icat domain",i=a.CONFIG.path,j={};if(b=a.trim(b),/!$/.test(b)&&(j.keep=!0,b=b.slice(0,b.length-1)),~b.indexOf("#")&&(e=b.split("#"),b=e[0],j.hash=e[1]),~b.indexOf("?")&&(e=b.split("?"),b=e[0],j.search=e[1]),f=b.lastIndexOf("/"),j.fileName=b.slice(f+1),b=b.slice(0,f+1),/\{\w+\}/.test(j.fileName)&&(j.fileName=w(j.fileName)),(/\{\w+\}/.test(b)||~b.indexOf("□"))&&(b=w(b),~b.indexOf("□")))return b=b.slice(1),~b.indexOf("^")?(e=b.split("^/"),j.delv=!0):e=b.replace(/^(\d+)/,"$1@").split("@/"),j.domain=+e[0],j.path=e[1],j;if(/^((\w+\:\/{2,})|\/\/)/.test(b)){var k;if(k="/"===b.charAt(0)?b.split(/(\/\/[^\/]+\/)/):b.split(/(\:\/{2,}[^\/]+\/)/),3===k.length?(j.protocol=k[0]||"",j.domain=k[0]+k[1],j.path=k[2]):(k="/"===b.charAt(0)?b.replace(/(\/\/[^\/]+\/)/,"$1@").split("@"):b.replace(/(\:\/{2,}[^\/]+\/)/,"$1@").split("@"),j.domain=k[0],j.path=k[1]),j.domain===g||j.domain===h){j.path=j.path.replace(/[\w\-]+\/\.\.\//g,"");var l=i.split("/"),m=j.path.split("/"),n=0;a.foreach(l,function(a,b){a==m[b]&&0===n?m[b]="@":n++}),j.domain=n-1,j.path=m.join("/").replace(/@(\/)?/g,"")}else j.weburl=!0}else if(~b.indexOf("\\"));else if(0===b.indexOf(".")){~b.indexOf("^")&&(j.delv=!0,b=b.replace("^",""));var o=b.charAt(1);if("/"==o)j.domain=d?"./":0,j.path=b.slice(2);else if("."==o){var p=/\.{2}\//g,q=(b.match(p)||[]).length;j.domain=q,j.path=b.replace(p,""),d&&(j.domain=b.replace(j.path,""))}}else{var r=v(c.baseURI||location.href);j.domain=r.domain,j.refRoot="/"===b.charAt(0),j.path=j.refRoot?b.slice(1):r.path+b,j.weburl=!0}return d&&(j.domain=j.domain||"",j.timestamp=j.search||"",delete j.search,j.path=(j.path||"").replace(/\d+(\.\d+){2}(\/)?$/,"")),j}}function w(b){var c=a.CONFIG.vars,d=b.match(/\{[^\}]+\}/g);return d?(a.foreach(d,function(a,d){var e,f=a.replace(/\{|\}/g,""),g=c[f];/\{\w+\}/.test(g)&&(g=w(g)),/^\d+$/.test(f)?b=0===d?b.replace(a,"□"+f):b.replace(a+"/",""):(e=new RegExp(a+(g?"":"/"),"g"),b=b.replace(e,g||""))}),b):b}a.RULECODE=a.RULECODE||{_index_:0},a.RULEFUNS=a.RULEFUNS||{},a.RULELIST=a.RULELIST||{},a.namespace("loader").config=function(b){var d,e,f,g=a.CONFIG,h=a.icatjs,i=/([\w\-]+\/\.\.\/)|\s+/g,j=a.isString(h)?h:h.getAttribute("src"),k=v(j.replace(i,""),!0),l=/[\W]?(debug\=\w+)/i;if(a.mixin(g,k),g.baseUrl=k.domain+k.path,f=k.hash?a.trim(k.hash,!0):"",f&&f.match(l)){var m=f.match(l)[1];m=m.slice(m.indexOf("=")+1),m&&("true"===m?g.DebugMode=!0:"false"===m?g.DebugMode=!1:(m=m.replace(/([\.\-\/])/g,"\\$1"),g.DebugMode=new RegExp(m,"i").test(location.href)),g.hash=g.hash.replace(l,""))}if(!a.isString(h)&&(d=(h.getAttribute("data-main")||"").replace(i,""),e=(h.getAttribute("data-deps")||"").replace(i,""),d||e)){var n=a.removeExcess(d);if(g.__depsfile=e?[e,d].join(","):d,/^\w+$/.test(n)){var o=v(c.baseURI||location.href);g.vars.appRef="/"+o.path}else g.vars.appRef=n.replace(/\/(assets\/js\/)?[^\/]+$/g,"")}return g.vars.appRef||a.ready(function(){for(var a=c.getElementsByTagName("script"),b=0,d=a.length;d>b;b++){var e=a[b].getAttribute("data-main"),f=a[b].src;if(e){g.vars.appRef=e.replace(/\/(assets\/js\/)?[^\/]+$/,"");break}if(/\/main[^\/]+$/.test(f)){g.vars.appRef=f.replace(/\/(assets\/js\/)?[^\/]+$/,"");break}}}),function(b){b.map&&(b.map=b.map.join("~")),a.mixin(a.CONFIG,b,v(b.base,!0)),a.CONFIG.baseUrl=a.CONFIG.domain+a.CONFIG.path}}(a.loader),a.foreach(["inc","include","require","use"],function(b){a.loader[b]=function(){var c=arguments,d=c[0],h="inc"===b?f:g;a.isObject(d)||(d={files:c[0],callback:c[1]}),e(d,h,b)}}),a.loader.weinreStart=function(b,d){var f,h=c.baseURI||location.href,i=h.match(/[\?&]weinre\=([^&]+)/),j=v(h),k=isNaN(j.domain)?j.domain:a.CONFIG.domain;if(b)d=d||"anonymous";else if(i){if("false"===i[1])return;var l=i[1].split("+");b=/^\w+\:\/{1,}/.test(l[0])?l[0]:k.replace(/(\:\d+)?\/$/,":"+(l[0]&&/^\d+$/.test(l[0])?l[0]:"8080")),d=l[1]||"anonymous"}else b=k.replace(/(\:\d+)?\/$/,":8080"),d="anonymous";f=b+"/target/target-script-min.js#"+d+"!",e({files:f},g)},a.loader.insert=m,a.util.getAliasFile=t;var x=/MSIE\s?[6-8]/.test(navigator.userAgent);!x&&a.IPMode&&a.loader.weinreStart(),~(c.baseURI||location.href).indexOf("loader_test")&&(a.loader_test={},a.mix(a.loader_test,{loadfile:e,trigger:j,optInsert:m,optDelete:n,optUpdate:o,insert:p,getRule:r,getOneRule:s,changeFileName:u,sliceURL:v,varsToValue:w})),a.loader.config({alias:{corecss:"../icatcss/core.min.css",require:"../../require",zepto:"../zepto/1.1.6/zepto",jquery:"../jquery-@version:1.10.2",underscore:"../underscore",backbone:"../backbone/backbone",mvclib:"../mvclib",mock:"../mock",storageBackbone:"../backbone/backbone, ../backbone/blocalstorage",
bootstrap:"../bootstrap/@VERSION:3.3.1/css/bootstrap.css, ../bootstrap/@VERSION:3.3.1/js/bootstrap",angular:"../angular/angular, ../angular/angular-router",n3:"../n3/n3.css, ../n3/n3",widgets:"{appRef}/assets/js/views/widget",common:"{appRef}/assets/js/common"}}),x&&!a.CONFIG.noHtml5Shim&&e({files:"../html5"},g,"include");var y=a.CONFIG.__depsfile;y&&e({files:y},g,"require")}(ICAT,this,document),function(a,b,c,d){function e(b,c){var d=function(){var d=Array.prototype.slice.call(arguments),e=d[0]||{},f=this,g=e.parentViewId?l(e.parentViewId):null;return e=a.mixin({},a.deepClone(c),e),g&&e.events&&a.foreach(g.events,function(a,b){e.events[b]&&delete e.events[b]}),d[0]=e,a.foreach(e,function(b,c){a.isFunction(b)&&(f[c]=b)}),b.apply(f,d)},e=function(){this.constructor=d};return e.prototype=b.prototype,d.prototype=new e,d.__super__=b.prototype,d}function f(c,d){if(c){b.PAGEDATA=b.PAGEDATA||{};var e=b.PAGEDATA[c],f=/(\{[^\}]+\})|(\[[^\]]+\])/;e?(a.isString(e)&&(/^[\d\^]+$/.test(e)&&(e=a.decode(e,p)),f.test(e)&&(e=JSON.parse(e))),d&&d(e)):a.wait(function(e){var g=b.PAGEDATA[c];return e&&(g={success:!1,message:"获取数据超时"}),g?(a.isString(g)&&(/^[\d\^]+$/.test(g)&&(g=a.decode(g)),f.test(g)&&(g=JSON.parse(g,p))),void(d&&d(g))):!1},1e3)}}function g(b){if(!b||b.indexOf("=>")<0)return{};b=a.trim(b);var c=b.split(/,\s*/),d={};return a.foreach(c,function(a){a=a.split("=>");var b=a[1]||"";d[a[0]]=~b.indexOf("=")?h(b):i(b)}),d}function h(b){var c={},d=b.split("&");return a.foreach(d,function(a){a=a.replace(/^([\w\-]+)\=/,"$1{@}").split("{@}"),c[a[0]]=i(a[1])}),c}function i(a){return""===a?d:/^(true|false)$/i.test(a)?"false"!==a:isNaN(a)?a:+a}function j(b,c,d){if(b&&a.$){var e,f=a.removeExcess(b),g=a.mix({},c,"isStorage, type, dataType");d=d||function(){},c.isStorage&&(e=a.util.storage(f),e&&d(JSON.parse(e))),a.$.ajax({url:b,data:g,type:c.type||"get",dataType:c.dataType,success:function(g){return a.isString(g)&&~g.indexOf("<!DOCTYPE html>")?void d({success:!1,dataError:!0,message:"返回数据有误",errorHtml:'<div class="data-error">'+b+"返回数据有误</div>"}):(g=a.isString(g)?JSON.parse(g):g,void(c.isStorage?k(e,g)||(a.util.storage(f,g),d(g)):d(g)))},error:function(){d({success:!1,dataError:!0,message:"返回数据有误"})}})}}function k(a,b){if(!a||!b)return!1;var c=JSON.stringify(a).replace(/\\|\'|\"|\s/g,""),d=JSON.stringify(b).replace(/\\|\'|\"|\s/g,"");return c===d}function l(b){var c=a.util.getView[b];return c?c:(a.foreach(a.util.getView,function(a,d){return a.vname===b?(c=a,!1):void 0},d,!0),c)}function m(b,c){var e,f=a.util.getModel._protocols,g=~b.sign.indexOf(",")?a.trim(b.sign,!0).split(","):[b.sign],h=!1;a.foreach(f,function(b,f){var i=f.match(/^([^@]+)/);if(i=i?i[1]:"",f=f.replace(i,""),a.hasItem(g,f.slice(1))&&c.cid==i){var j=c[f]===d?b.on:c[f];return j&&(e=a.isFunction(b.callback)?b.callback:c[b.callback]),!(h=!0)}}),h?e&&e.call(c,b.message):c._msgHandle(b)}function n(b,c){var d=$(b),e=a.widget[c];d.removeAttr("icat-widget");var f=g(d.attr("icat-widget-config")),h=g(d.attr("icat-widget-mconfig"));f.displayType=f.displayType||0,f.__freeport=!0,0!=f.displayType?f.menu=b:f.el=b,f.mconfig=h,new e(f,a.util.getController.__current_ctrl)}function o(b,c){var e,f=!1;a.foreach(a.widget,function(a){return a.wgtype&&a.wgtype==b?(c(a),!(f=!0)):void 0},d,!0),f||a.wait(function(d){return a.widget[b]||d?void(d?a.loader.require(b,function(){e=a.widget[b],e&&c(e)}):c(a.widget[b])):!1},1e3)}var p=a.CONFIG.secretKey||"vkme:valleykiddy@gmail.com";a.util({getController:function(b){if(b=b||a.util.getController.CTRLCONFIG||{},void 0!==Backbone.Controller)return Backbone.Controller.extend(b);var c,d=Backbone.Events,e=Backbone.Collection.extend,f=Backbone.Controller=function(b){this.initialize.apply(this,arguments),a.util.getController.__current_ctrl=this};return b.rconfig&&(c=b.rconfig,delete b.rconfig),_.extend(f.prototype,d,a.mixin({initialize:function(b,d,e,f){var g,h,i=this;i.views=[],d=d?d:e||a.util.getView.VIEWCONFIG||{},i.ctrlList=f,h=d.PageSetting?d.PageSetting[b]:"",h=a.isObject(h)?h.widgets:h||"",h=a.isArray(h)?h.join(","):h,i.widgets=h.replace(/\s/g,"").split(","),i.viewConfig={},a.mix(i.viewConfig,e,"PageSetting"),a.mixin(i.viewConfig,d),i.loadWidget(),c&&(g=Backbone.Router.extend(c),i.backboneRouter=new g(i),Backbone.history.start())},loadWidget:function(){var b,c,d=this;d.ctrlList&&(a.isString(d.ctrlList)?(b=d.ctrlList.replace(/\s/g,"").split(","),c=!1):(b=d.ctrlList,c=!0)),d._widgets(d.widgets,null,b,c)},importWidget:function(b,c){if(b){var d=this;b=a.isArray(b)?b.join(","):b,b=b.replace(/\s/g,"").split(","),d._widgets(b,c)}},_widgets:function(b,c,d,e){var f=this,g=f.viewConfig;a.foreach(b,function(b){if((!e||a.hasItem(d,b))&&(e||!a.hasItem(d,b))){var h=g[b]||{};h.el=h.el||'[data-wgtype="'+b+'"]';var i=$(h.el).getCurrentView(),j=h.wgclass||b,k=a.widget[j];return k&&i instanceof k?(i.commParams=a.deepClone(a.ROUTERPARAM)||{},a.mixin(i.commParams,a.deepClone(c)),a.mix(i.commParams,a.deepClone(h.mconfig),["params","MergeData"]),i.commParams.params=i.commParams.params||{},void i.refresh()):void(k?new k(h,f):o(j,function(a){new a(h,f)}))}})},getViewByName:l,addView:function(b){var c=a.isObject(b)?b.cid:b;this.views.push(c)},delView:function(b){var c=a.isObject(b)?b.cid:b;a.removeItem(this.views,c)},pipe:function(b){if(b&&a.isObject(b)){a.foreach(this.views,function(c){if(c!==b.sender){var d=a.util.getView[c].model;m(b,d)}})}}},b)),f.extend=e,Backbone.Controller.extend(b)},getModel:function(b){return Backbone.Model.extend(a.mixin({defaults:{MergeData:{}},initialize:function(b,c,d){var e=this,f={};a.util.getModel._protocols=a.util.getModel._protocols||{},d.protocols&&(e.protocols=e.protocols||{},a.mixin(e.protocols,d.protocols),delete d.protocols),e.addProtocols(e.protocols),a.foreach(d,function(a,b){"@"===b.charAt(0)&&(f[b.slice(1)]=a,delete d[b])}),a.foreach(e,function(a,b){"@"===b.charAt(0)&&(f[b.slice(1)]=a,delete e[b])}),a.mix(e,d),e.addProtocols(f),a.util.getModel[e.cid]=e},getData:function(b,c,d){a.isFunction(c)&&(d=c,c={}),c=a.deepClone(c)||{},j(b,c,d)},postData:function(b,c,d){a.isFunction(c)&&(d=c,c={}),c=a.deepClone(c)||{},a.mixin(c,{type:"post"}),j(b,c,d)},jsonpData:function(b,c,d){a.isFunction(c)&&(d=c,c={}),c=a.deepClone(c)||{},a.mixin(c,{dataType:"jsonp"}),j(b,c,d)},fetchData:function(a,b,c){/^((\w+\:\/{2,})|\/\/)/.test(a)?this.jsonpData(a,b,c):this.getData(a,b,c)},chunkData:f,_msgHandle:function(b){var c=a.util.getModel._protocols;c[this.cid+"@"+b.sign]||this.getMessage(b)},getMessage:function(a){},sendMessage:function(b,c,e){var f=this.getMyView()||{},g={sign:b||"anonym",sender:f.vname||f.cid,message:c};e?(e=a.isString(e)?l(e):e,e&&m(g,e.model)):this.controller?this.controller.pipe(g):f.__freeport&&a.foreach(a.util.getView,function(a,b){if(a.vname!==g.sender&&a.cid!=g.sender){var c=a.model;m(g,c)}},d,!0)},addProtocols:function(b){if(a.isObject(b)){var c=this;a.foreach(b,function(b,d){var e=a.util.getModel._protocols,f=c.cid+"@"+d;a.isObject(b)?e[f]=b:a.isFunction(b)?e[f]={callback:b,on:!0,description:"icat widget"}:e[f]&&(e[f].on=!!b)})}},protocolOn:function(b){var c=a.util.getModel._protocols;b&&c[b]&&(c[b].on=!0)},protocolOff:function(b){var c=a.util.getModel._protocols;b&&c[b]&&(c[b].on=!1)}},b))},getView:function(b){b=b||{},b=a.deepClone(b),b.official&&(a.mixin(b,{delegate:function(a,b,d){return $(c).on(a+".delegateEvents"+this.cid,b,d),this},undelegateEvents:function(){return $(c).off(".delegateEvents"+this.cid),this}}),delete b.official);var f,h,i,j=["model","collection","el","id","attributes","className","tagName","events"],k=_.pick(b,j),l=b.wgtype,m={initialize:function(b,c,e){var f=this;f.el||(f.el=b.el),a.mix(f,b,j.join(",")),c=c||a.util.getController.__current_ctrl;var g=f.mconfig||{},h={};if(a.foreach(g,function(b,c){(a.isFunction(b)||"@"===c.charAt(0)||"protocols"===c)&&(h[c]=b,delete g[c])}),e=e||f.model||a.util.getModel(),a.isFunction(e)?(a.mix(h,{viewId:f.cid,controller:c,getMyView:function(){return a.util.getView[this.viewId]}}),f.model=new e(null,null,h)):(a.mix(e,h),e.controller=c),f.commParams=a.deepClone(a.ROUTERPARAM)||{},a.mix(f.commParams,a.deepClone(g),["params","MergeData"]),f.commParams.params=f.commParams.params||{},f.model.commParams=f.commParams,f.__config=b,f.template=f.getTemplate(f.tpl),f.hasPlugin=f.plugins&&f.plugins.length,a.util.getView[f.cid]=f,c&&c.addView(f.cid),f.template){if(f.init(),f.controller=c,f.vname=f.vname||f.cid,a.util.getLifecycle(f.vname+"-renderBegin",(new Date).getTime()-_BaseTime_),f.style&&a.util.insertCss[f.widgetName]===d){var i=a.decode(f.style,"vkme:valleykiddy@gmail.com");a.util.insertCss(i),a.util.insertCss[f.widgetName]=!0}f.displayType=f.displayType||0,1==f.displayType||2==f.displayType?(f.model.set(g),f.listenTo(f.model,"change",f.render),f._render(!0)):(f.listenTo(f.model,"change",f.render),f.model.set(a.isEmptyObject(g)?{widgetSlogan:"trigger me..."}:g))}},init:function(){},beforeRender:function(a){return a},afterRender:function(){},setPlugins:function(){},render:function(){this._render()},renderWithData:function(a){this._render(!1,a)},dataRender:function(a){this._render(!1,a)},_render:function(b,e){var f=this,g=f.model,h=g.get("dcname"),i=g.get("MergeData");if(f.preventFirstRender)return f.$el.each(function(){this.viewId=f.cid}),$(f.menu).each(function(){this.viewId=f.cid}),f.preventFirstRender=!1;if(b&&f.menu){if(f.$menu=$(f.menu),!f.$menu.length)return;f._handleRender();var j=a.isString(f.menu)?f.menu:f.$menu.selector;a.foreach(f.events,function(b,d){if(/^\d@/.test(d)&&(d=d.split("@"),f.displayType==d[0])){var e=d[1],g=a.isString(b)?f[b]:b,h=e.match(/^(\S+)\s*(.*)$/),i=h[1]+"."+f.widgetName;if(!g)return;$(c).off(i).on(i,j+" "+h[2],_.bind(g,f))}}),!f.$el.length&&f.el&&f.setElement(f.el)}if(e){var k=f.beforeRender(e);k&&(k=a.mixin({},i,k),f._bodyRender(k),f._afterRender(k))}else h?g.chunkData(h,function(b){f.originalData=a.deepClone(b);var c=f.beforeRender(b),e=c.success!==d?c.success:!0;c&&e?(c=a.mixin({},i,c),f._bodyRender(c),f._afterRender(c)):g.asyncfunc&&g.asyncfunc(function(b){f.originalData=a.deepClone(b);var c=f.beforeRender(b);c&&(c=a.mixin({},i,c),f._bodyRender(c),f._afterRender(c))}),g.unset("dcname",{silent:!0})}):g.asyncfunc?g.asyncfunc(function(b){f.originalData=a.deepClone(b);var c=f.beforeRender(b);c&&(c=a.mixin({},i,c),f._bodyRender(c),f._afterRender(c))}):(f._bodyRender(i),f._afterRender(i))},_handleRender:function(){var b=this,c=b.model,d=c.get("MergeData");b.$menu.each(function(){this.viewId=b.cid;var c,e=$(this),f=e.closest("[data-MergeData], [data-InitData]"),h=g(f.attr("data-MergeData")),i=g(f.attr("data-InitData")),j=a.mixin({},d,h,i);j.__toolRender__=!0,j.displayType=b.displayType,c=b.template(j),e.html(b.style?c:c.replace(/<\/?widget[^>]+>/g,"")),f.removeAttr("data-InitData")})},_bodyRender:function(b){var c=this,d=(c.model,a.trim(c.insertWay||"")||"html");c.$el.each(function(){this.viewId=c.cid;var e,f=$(this),h=f.closest("[data-MergeData], [data-InitData]"),i=f.find("[lazy-load-wrap]"),j=g(h.attr("data-MergeData")),k=g(h.attr("data-InitData")),l=a.mixin({},b,j,k);if(l.displayType=c.displayType,i[0]&&i.attr("data-from")===c.widgetName){var m=i.attr("lazy-load-wrap");e=c.getMicroTemplate(m,l),i[d](e||"")}else e=c.template(l),f[d](c.style?e:e.replace(/<\/?widget[^>]+>/g,""));h.removeAttr("data-InitData")})},_afterRender:function(b){var c=this;if(c.hasPlugin&&a.loader.require(c.plugins,function(){c.setPlugins(b)}),a.util.getLifecycle(c.vname+"-renderEnd",(new Date).getTime()-_BaseTime_),c.extentions){var d;d=c.controller?c.controller.viewConfig||{}:c.subConfig||{},a.foreach(c.extentions,function(b){var e=a.deepClone(d[b])||{};e.el=c.$(e.el||'[data-wgtype="'+b+'"]'),e.parentViewId=c.cid;var f=e.el.getCurrentView(),g=e.wgclass||b,h=a.widget[g];return h&&f instanceof h?(f.commParams=a.deepClone(a.ROUTERPARAM)||{},a.mix(f.commParams,a.deepClone(e.mconfig),["params","MergeData"]),f.commParams.params=f.commParams.params||{},void f.refresh()):void(h?new h(e,c.controller):o(g,function(a){new a(e,c.controller)}))})}c.afterRender(b),a.util.viewRender(c.$el)},copy:function(a){return new this.constructor(a)},refresh:function(){this.model.set("timestamp",(new Date).getTime())},destroy:function(){var b=this;return b.$menu&&b.$menu.each(function(){delete b.viewId}).empty(),b.$el.each(function(){delete b.viewId}).empty(),b.stopListening(),b.controller&&b.controller.delView(b.cid),delete a.util.getView[b.cid],b},getTemplate:function(b,c){return a.util.getTemplate(b,c,this.widgetName)},getMicroTemplate:function(b,c){var d=this.widgetName?this.widgetName+"_":"";return a.util.getMicroTemplate(d+b,c)}};return h=a.deepClone(m),a.mix(h,b,j.join(",")),i=Backbone.View.extend(h),f=e(i,k),l&&(f.wgtype=l),f}}),a.util({getChunkData:f,getViewByName:l,viewRender:function(b){b=b||$("body"),b.find("[icat-widget]").each(function(b,c){if(!c.viewId){var d=$(c),e=d.attr("icat-widget"),f=a.widget[e];if(f)n(c,e);else{var g=d.attr("icat-widget-path");g?a.loader.require(g,function(){a.widget[e]&&n(c,e)}):o(e,function(){n(c,e)})}}})}}),b.Backbone&&b.Backbone._viewRender_===d&&(a.util.viewRender(),b.Backbone._viewRender_=!0),~(c.baseURI||location.href).indexOf("mvc_test")&&(a.mvc_test={},a.mix(a.mvc_test,{getChunkData:f,getDomData:g,fetchData:j}))}(ICAT,this,document);